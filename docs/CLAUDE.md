# 캘리 (Cally)

## 프로젝트 설명
체험단 통합 검색 + 구글 캘린더 연동 서비스. 여러 체험단 사이트를 크롤링해서 한 곳에서 검색하고, 당첨 시 구글 캘린더에 자동으로 일정을 등록해주는 웹 서비스.

## 핵심 차별점
- 기존 서비스(인플렉서, 모아뷰): 검색만 제공
- Cally: 검색 + **구글 캘린더 연동** + 마감 알림 + **네이버 로그인 세션 공유**

## 기술 스택
- **Frontend**: Next.js 14 (App Router) + Tailwind CSS
- **Backend/DB**: Supabase (Auth, PostgreSQL, Edge Functions)
- **Crawler**: Python (BeautifulSoup) + GitHub Actions
- **Calendar**: Google Calendar API
- **Deployment**: Vercel

## 폴더 구조
```
/app
  /api              # API Routes
  /(auth)           # 로그인 관련 페이지
  /(main)           # 메인 서비스 페이지
/components
  /ui               # 공통 UI 컴포넌트
  /features         # 기능별 컴포넌트
/lib
  /supabase.ts      # Supabase 클라이언트
  /utils.ts         # 유틸 함수
/types
  /database.ts      # Supabase 타입
/crawler            # Python 크롤러 (별도 폴더)
```

## 주요 기능
1. **체험단 통합 검색** (무료) ✅
   - 7개 사이트 크롤링 (400개+ 체험단)
     - 리뷰노트, 디너의여왕, 강남맛집, 리뷰플레이스
     - 서울오빠, 모두의체험단, 파블로
   - 필터: 지역, 카테고리, 유형, 마감순
   - **스마트 서치**: 자연어 검색 기능
     - 예: "강남 이번주 맛집" → 자동으로 지역, 마감일, 카테고리 필터링
     - 예: "마감임박 강원 숙박" → 마감임박, 지역, 카테고리 자동 인식
   - **제목 검색**: 게시물 제목으로도 검색 가능
   - **자주 찾는 태그**: 사용자별 검색 기록 기반 태그 표시
   - **리뷰 기간 정보**: 각 체험단의 리뷰 작성 기간 자동 표시
   - **페이지네이션**: "더보기" 버튼으로 무한 스크롤
   - GitHub Actions로 하루 2회 자동 크롤링 (오전 9시, 오후 10시 KST)
   - Supabase에 크롤링 데이터 저장 및 실시간 검색
   - 마감 캠페인 자동 필터링
   - 중복 데이터 자동 제거

2. **북마크 관리** (무료) ✅
   - 체험단 북마크 저장
   - 북마크 목록 보기 (`/my/campaigns`)
   - 리뷰 마감일 자동 계산 (각 체험단의 `review_deadline_days` 기반)

3. **신청 트래킹** (무료) ✅
   - 신청한 체험단 관리 (`/my/campaigns`)
   - 당첨 여부 체크 기능
   - 당첨 시 "선정" 상태로 전환

4. **구글 캘린더 연동** (무료) ✅
   - 구글 OAuth 인증 (`/settings`)
   - 당첨 시 방문일/마감일 구글 캘린더에 자동 등록
   - 캘린더 일정 수정/삭제 동기화
   - Refresh Token으로 장기 사용 가능

5. **마감 임박 알림** (무료) ✅
   - 마이페이지 접속 시 D-3 이하 체험단 배너로 알림
   - 색상별 긴급도 표시 (빨강: D-1, 주황: D-2, 노랑: D-3)
   - 배너 클릭 시 해당 체험단 상세 페이지로 이동

6. **체험단 관리 통합 페이지** (무료) ✅
   - `/my/campaigns`에서 북마크/신청/선정/완료 통합 관리
   - 상태별 탭 (개수 표시)
   - 리스트 ⇄ 캘린더 뷰 전환
   - 방문 예정일 입력 (선택사항)
   - 선정일 기준 리뷰 마감일 자동 계산
   - 신청 마감일 전 선정 버튼 비활성화

7. **네이버 로그인 세션 공유** (무료) ✅
   - Cally에서 네이버 로그인 시 네이버 세션 유지
   - 체험단 원본 사이트 이동 시 별도 로그인 불필요
   - 대부분의 체험단 사이트가 네이버 블로그 인증 필수이므로 원클릭 신청 가능

## 완료된 Phase
- [x] Phase 0: 기획 및 문서화 ✅
- [x] Phase 1: 프로젝트 셋업 ✅
  - [x] Next.js 14 + Tailwind CSS 초기 설정
  - [x] Supabase 프로젝트 생성 및 연결
  - [x] 기본 폴더 구조 생성
  - [x] 환경 변수 설정
- [x] Phase 2: 크롤러 개발 ✅
  - [x] Python 환경 설정 (BeautifulSoup, requests)
  - [x] 크롤러 기본 구조 설계
  - [x] 7개 사이트 크롤러 구현:
    - 리뷰노트 (API 기반)
    - 레뷰 (REVU) - 로그인 필요로 보류
    - 디너의여왕 (HTML 파싱)
    - 강남맛집 (HTML 파싱)
    - 리뷰플레이스 (HTML 파싱)
    - 서울오빠 (HTML 파싱)
    - 모두의체험단 (HTML 파싱)
    - 파블로 (HTML 파싱)
  - [x] 크롤링 데이터 정제 (카테고리, 지역, 마감일)
  - [x] 마감 캠페인 자동 필터링
  - [x] 중복 데이터 자동 제거
  - [x] GitHub Actions 스케줄링 설정 (하루 2회)
  - [x] Supabase DB 저장 연동 완료
- [x] Phase 3: 인증/회원 시스템 ✅
  - [x] 로그인 페이지 UI 구현 (구글/네이버)
  - [x] 구글 로그인 연동 완료 ✅
  - [x] 네이버 로그인 연동 완료 ✅
    - **핵심 가치**: 네이버 세션 공유로 체험단 원본 사이트 원클릭 신청!
    - 대부분의 체험단 사이트가 네이버 블로그 인증 필수
  - [x] 로그인 상태 관리 개선
  - [x] 인증 콜백 처리 및 세션 관리
  - [x] 사용자 프로필 메뉴 및 로그아웃 기능
  - [x] 인증 미들웨어 (임시로 비활성화 - 개발 편의)
  - [x] Supabase 데이터베이스 설정 (테이블, 트리거, RLS)
  - [x] 환경 변수 설정
  - [x] OAuth 프로바이더 설정 완료 - `docs/NAVER_OAUTH_SETUP.md` 참고
- [x] Phase 4: 검색 기능 ✅
  - [x] 검색 페이지 UI 구현
  - [x] 필터 컴포넌트 구현
  - [x] 검색 API 엔드포인트 구현
  - [x] 체험단 상세 페이지 구현
  - [x] 북마크 기능 추가
  - [x] **스마트 서치**: 자연어 검색 기능
    - "강남 이번주 맛집" → 지역, 마감일, 카테고리 자동 필터링
    - "마감임박 강원 숙박" → 마감임박, 지역, 카테고리 자동 인식
  - [x] **제목 검색**: 게시물 제목으로도 검색 가능
  - [x] **자주 찾는 태그**: 사용자별 검색 기록 기반 태그 표시
- [x] Phase 5: 신청/북마크 관리 ✅
  - [x] 북마크 추가/삭제 기능 (`/my/bookmarks`)
  - [x] 신청 등록 기능 (`/my/applied`)
  - [x] 신청 목록 페이지 UI
  - [x] 당첨 체크 기능 (선정 여부 표시)
  - [x] 신청 취소 기능
- [x] Phase 6: 프리미엄 기능 ✅
  - [x] 구글 캘린더 OAuth 연동 (`/api/auth/google-calendar/*`)
  - [x] 당첨 시 자동 캘린더 일정 등록
  - [x] 방문일/리뷰 마감일 캘린더 동기화
  - [x] Refresh Token 관리 (장기 사용 가능)
  - [x] 설정 페이지 구글 캘린더 연결 UI
- [x] Phase 6.5: 비즈니스 모델 변경 ✅
  - [x] 프리미엄 구독 모델 폐기
  - [x] 완전 무료 모델로 전환 (Phase 1: 사용자 확보)
  - [x] `is_premium` 체크 로직 제거
  - [x] 알림 기능 변경: 이메일 제거 → 마이페이지 배너로 교체
  - [x] "무료" 강조 최소화 (불안감 방지)
  - [x] 프리미엄 페이지 → 서비스 소개 페이지로 재구성
- [x] Phase 6.6: OAuth 설정 & UI 통합 ✅
  - [x] 구글 OAuth 설정 완료
    - 구글 로그인 (Supabase 프로바이더)
    - 구글 캘린더 연동 (직접 API)
  - [x] 네이버 OAuth 설정 완료
    - 네이버 로그인 (세션 공유 전략)
  - [x] 체험단 관리 페이지 통합 (`/my/campaigns`)
    - 북마크/신청/선정/완료 탭 통합
    - 리스트 ⇄ 캘린더 뷰
    - 방문 예정일 입력
    - 리뷰 마감일 자동 계산 (선정일 기준)
  - [x] 선정 버튼 비활성화 (신청 마감일 전)
  - [x] 카드 클릭 시 원본 사이트로 직접 이동

## 최근 업데이트 (역순)

### UI/UX 전면 재설계 완료 (2025-12-06)
- ✅ **디자인 시스템 구축**
  - 코랄 핑크 (#FF6B9D) 메인 컬러
  - Glassmorphism 스타일
  - 통합된 타이포그래피
  - 애니메이션 유틸리티
- ✅ **메인 페이지 재설계**
  - 그라데이션 히어로
  - 주요 기능 카드
  - 통계 섹션
  - CTA 섹션
- ✅ **검색 페이지 재설계**
  - 그라데이션 헤더
  - 스마트 검색 배지
  - 로딩 애니메이션
  - 카드 그리드 애니메이션
- ✅ **마이페이지 재설계**
  - 인사말 헤더
  - 마감 알림 배너
  - 주요 기능 카드
  - 캘린더 뷰
- ✅ **Phase 5: 공통 컴포넌트 업그레이드**
  - Button, Card, Badge 개선
  - LoadingSpinner, Toast 신규 추가
  - 통일된 디자인 시스템
- ✅ **Phase 6: 애니메이션 강화**
  - 10종류 애니메이션 추가
  - fade, slide, scale, bounce, shake, float, glow
  - 부드러운 easing 함수
- ✅ **Phase 7: 반응형 최적화**
  - 3단계 breakpoint (Mobile/Tablet/Desktop)
  - 터치 디바이스 최적화
  - Reduced motion 지원
  - 접근성 개선
- ✅ **문서화**
  - `docs/UI_UX_REDESIGN.md` - 전체 재설계 제안서
  - `docs/UI_UX_REDESIGN_SUMMARY.md` - 완료 보고서
  - `docs/PHASE_7_COMPLETE.md` - Phase 5~7 완료 보고서

### 네이버 로그인 세션 공유 전략 (2025-12-06)
- ✅ **카카오 로그인 제거, 네이버 로그인으로 교체**
  - 대부분의 체험단 사이트가 네이버 블로그 인증 필수
  - Cally에서 네이버 로그인 시 → 원본 사이트에서도 로그인 유지
  - 별도 로그인 없이 원클릭 신청 가능!
- ✅ OAuth 프로바이더: 구글 + 네이버
- ✅ `docs/NAVER_OAUTH_SETUP.md` 가이드 작성
- ✅ 관련 문서 업데이트 (CLAUDE.md, DEVELOPMENT_CHECKLIST.md, PROJECT_PLANNING.md)
- ✅ **네이버 OAuth 직접 구현 완료**
  - `/api/auth/naver/connect` - OAuth 인증 시작
  - `/api/auth/naver/callback` - 콜백 처리 및 세션 생성
  - 고정 비밀번호 방식으로 안정적인 로그인 구현
  - 기존 사용자 자동 업데이트 처리
- ✅ 테스트 완료: 네이버 로그인 → 메인 페이지 리다이렉트 성공!

### 기능 개선
- ✅ 북마크 기능 UX 개선: 클릭 시 저장 + 아이콘 색상 변경
- ✅ 로그인/마이페이지 접근 개선: 비로그인 사용자 안내 UI
- ✅ 마이페이지 메인 대시보드 추가 (`/my`): 5개 카드 레이아웃
- ✅ 네이버 로그인 연동 완료 (원본 사이트 세션 공유 전략)
- ✅ 구글 캘린더 연동 UX: 마이페이지 배너 + 전용 카드
- ✅ 마감 임박 알림: D-3 이하 체험단 배너 표시 (색상별 긴급도)
- ✅ 스마트 서치 (자연어 검색 + 제목 검색 + 자주 찾는 태그)
- ✅ 페이지네이션: "더보기" 버튼으로 무한 스크롤

### 비즈니스 모델 변경
- ✅ 프리미엄 구독 모델 → 개방형 성장 모델로 전환
- ✅ Phase 1 (현재): 모든 기능 제공, 사용자 확보 집중
- ✅ Phase 2 (6개월): 기능 확장 + 광고 도입 검토
- ✅ Phase 3 (12개월): B2B 중개 플랫폼 전환
- ✅ is_premium 체크 로직 제거: 모든 사용자에게 모든 기능 제공
- ✅ "무료" 강조 최소화: 자연스러운 서비스 메시징
- ✅ 프리미엄 페이지 → 서비스 소개 페이지로 재구성

### UI/UX 개선
- ✅ 프리미엄 페이지 → 서비스 소개 페이지로 재구성
- ✅ "무료" 배지 제거 (불안감 방지)
- ✅ FAQ 간소화 (가격 관련 질문 제거)
- ✅ 메시징 자연스럽게 변경
- ✅ **체험단 관리 페이지 통합** (`/my/campaigns`):
  - 북마크/신청/선정/완료 페이지 하나로 통합
  - 상태별 탭 (개수 표시)
  - 리스트 ⇄ 캘린더 뷰 전환
  - 방문 예정일 입력 (선택사항)
  - 선정일 기준 리뷰 마감일 자동 계산
  - 신청 마감일 전 선정 버튼 비활성화

### Visual Upgrade (2025-12-05)
- ✅ **디자인 시스템 구축**: Modern Indigo 테마 적용
- ✅ **UI 컴포넌트 라이브러리**: Button, Card, Footer 등 재사용 컴포넌트 구현
- ✅ **랜딩 페이지 리디자인**: 모던한 히어로 섹션, Glassmorphism 헤더 적용
- ✅ **타이포그래피 개선**: 가독성 향상 및 세련된 폰트 스타일 적용

### 7개 사이트 통합 & 페이지네이션 (2025-12-06)
- ✅ **3개 사이트 추가 크롤러 구현**:
  - 서울오빠 (192개)
  - 모두의체험단 (52개)
  - 파블로 (70개)
- ✅ 총 7개 사이트, 400개+ 체험단 통합
- ✅ 마감 캠페인 자동 필터링 (크롤링 시점 & DB 정리)
- ✅ 중복 데이터 자동 제거 (430개 → 400개)
- ✅ 리뷰노트 URL 수정 (/campaign/ → /campaigns/)
- ✅ **페이지네이션 구현**: "더보기" 버튼으로 50개씩 로드
- ✅ Next.js 이미지 호스트 설정 (7개 사이트 도메인)

## 문서
- `PROJECT_PLANNING.md`: 전체 프로젝트 기획서
- `DEVELOPMENT_CHECKLIST.md`: 개발 체크리스트 (상세)
- `PHASE3_SETUP.md`: Phase 3 설정 가이드 (사용자 테이블, 트리거, RLS)
- `GITHUB_ACTIONS_SETUP.md`: GitHub Actions 크롤러 스케줄링 설정 가이드
- `SMART_SEARCH.md`: 스마트 서치 기능 가이드
- `DESIGN_SYSTEM.md`: 디자인 시스템 가이드 (컬러, 타이포그래피, 컴포넌트)
- `NAVER_OAUTH_SETUP.md`: 네이버 OAuth 설정 가이드 (세션 공유 전략 포함)

## 자주 사용하는 명령어
```bash
npm run dev          # 개발 서버
npm run build        # 빌드
npm run lint         # 린트
```

## 환경 변수
`.env.local` 파일에 다음 변수들 필요:
- NEXT_PUBLIC_SUPABASE_URL
- NEXT_PUBLIC_SUPABASE_ANON_KEY
- SUPABASE_SERVICE_ROLE_KEY
- GOOGLE_CLIENT_ID / SECRET (로그인 & 캘린더)
- NAVER_CLIENT_ID / SECRET (로그인)
